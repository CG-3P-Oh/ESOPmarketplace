jQuery( document ).ready( function($) {

	// Click on stripe button.
	if ( $( '.dipl_stripe_button' ).length > 0 ) {
		$( '.dipl_stripe_button' ).on( 'click', '.dipl_stripe_button_wrapper .et_pb_button', function(e) {
			e.preventDefault();

			let $this   = $( this );
			let wrapObj = $this.parent();
			let $props  = wrapObj.data();

			$this.prop( 'disabled', true );
			wrapObj.next( '.dipl_stripe_error' ).html( '' )

			$.ajax( {
				type: 'POST',
				url: DiviPlusFrontendData.ajaxurl,
				data: {
					action: 'dipl_stripe_generate_session', 
					dipl_stripe_nonce: DiviPlusFrontendData.ajaxnonce,
					props: $props
				},
				success: function( response ) {
					$this.prop( 'disabled', false );
					if ( response.success && response.data.session_url ) {
						window.location.href = response.data.session_url;
					} else {

						var errorMsg = response.data?.error || 'Something went wrong.';

						wrapObj.next( '.dipl_stripe_error' ).html( errorMsg );
						console.error( errorMsg );
					}
				}
			} );
		} );
	}
} ); // Document ready.
