jQuery( document ).ready( function($) {

	if ( $( '.dipl_scrolling_zoom_gallery' ).length > 0 ) {
		gsap.registerPlugin( ScrollTrigger );
		document.querySelectorAll( '.dipl_scrolling_zoom_gallery' ).forEach( ( gallery, galleryIndex ) => {
			let scroller     = gallery.querySelector( '.dipl_scroll_zoom_gallery_scroller' ),
				innerObj     = gallery.querySelector( '.dipl_scroll_zoom_gallery_inner' ),
				images       = gallery.querySelectorAll( '.dipl_scroll_zoom_gallery_item' ),
				startOpacity = parseFloat( scroller.dataset.start_opacity ),
				imageCount   = images.length;

			// Cleanup previous ScrollTriggers if any.
			ScrollTrigger.getAll().forEach( t => {
				if ( t.trigger === scroller ) t.kill();
			} );

			let tl = gsap.timeline( {
				defaults: {
					duration: ( imageCount * 2 ),
					ease: 'none'
				},
				scrollTrigger: {
					trigger: scroller,
					start: "top top",
					end: `+=${imageCount * 150}%`,
					scrub: 1,
					pin: true,
					anticipatePin: 1,
					onEnter: () => document.documentElement.classList.add( 'dipl_hide_scrollbar' ),
					onLeave: () => document.documentElement.classList.remove( 'dipl_hide_scrollbar' ),
					onEnterBack: () => document.documentElement.classList.add( 'dipl_hide_scrollbar' ),
					onLeaveBack: () => document.documentElement.classList.remove( 'dipl_hide_scrollbar' )
				}
			} );
			images.forEach( ( img, i ) => {
				let translateZ = ( i + 1 ) * 200 + 100,
					transZ = '-' + ( i + 1 ) * 200;
				tl.to( innerObj, { z: translateZ } ).fromTo( img, { opacity: startOpacity, z: transZ }, { opacity: 1, z: transZ }, i );
			} );
		} );
	}
} ); // Over document ready.
